<?xml version="1.0"?>
<yandex>
    <!-- 日志级别 -->
    <logger>
        <level>information</level>
        <console>true</console>
    </logger>

    <!-- HTTP协议设置 -->
    <http_port>8123</http_port>
    <tcp_port>9000</tcp_port>
    <mysql_port>9004</mysql_port>
    <postgresql_port>9005</postgresql_port>

    <!-- 监听所有接口 -->
    <listen_host>::</listen_host>

    <!-- 数据库目录 -->
    <path>/var/lib/clickhouse/</path>
    <tmp_path>/var/lib/clickhouse/tmp/</tmp_path>
    <user_files_path>/var/lib/clickhouse/user_files/</user_files_path>
    <format_schema_path>/var/lib/clickhouse/format_schemas/</format_schema_path>

    <!-- 时区设置 -->
    <timezone>Asia/Shanghai</timezone>

    <!-- 内存限制 -->
    <max_memory_usage>10000000000</max_memory_usage>
    <max_memory_usage_for_user>10000000000</max_memory_usage_for_user>
    <max_memory_usage_for_all_queries>20000000000</max_memory_usage_for_all_queries>

    <!-- 最大并发查询数 -->
    <max_concurrent_queries>100</max_concurrent_queries>

    <!-- 数据库默认引擎 -->
    <default_database_engine>Ordinary</default_database_engine>

    <!-- 数据压缩设置 -->
    <compression>
        <case>
            <min_part_size>1000000000</min_part_size>
            <min_part_size_ratio>0.01</min_part_size_ratio>
            <method>lz4</method>
        </case>
    </compression>

    <!-- 允许使用DDL -->
    <allow_ddl>1</allow_ddl>

    <!-- 开启内置字典 -->
    <builtin_dictionaries_reload_interval>3600</builtin_dictionaries_reload_interval>

    <!-- 用户目录配置 -->
    <user_directories>
        <users_xml>
            <path>/etc/clickhouse-server/users.xml</path>
        </users_xml>
    </user_directories>

    <!-- 缓存设置 -->
    <mark_cache_size>5368709120</mark_cache_size>
    <uncompressed_cache_size>8589934592</uncompressed_cache_size>

    <!-- 最大线程数 -->
    <max_threads>8</max_threads>
    <max_insert_threads>0</max_insert_threads>

    <!-- 限流设置 -->
    <max_bytes_before_external_group_by>20000000000</max_bytes_before_external_group_by>
    <max_bytes_before_external_sort>20000000000</max_bytes_before_external_sort>

    <!-- MergeTree设置 -->
    <merge_tree>
        <max_suspicious_broken_parts>5</max_suspicious_broken_parts>
        <parts_to_delay_insert>150</parts_to_delay_insert>
        <parts_to_throw_insert>300</parts_to_throw_insert>
        <max_bytes_to_merge_at_max_space_in_pool>10737418240</max_bytes_to_merge_at_max_space_in_pool>
        <min_bytes_for_wide_part>0</min_bytes_for_wide_part>
        <min_rows_for_wide_part>0</min_rows_for_wide_part>
    </merge_tree>

    <!-- 异步插入 -->
    <async_insert>1</async_insert>
    <async_insert_threads>16</async_insert_threads>
    <async_insert_max_data_size>1000000</async_insert_max_data_size>
</yandex>