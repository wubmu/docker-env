version: '3.8'

services:
  code-server:
    # 使用本地Dockerfile构建镜像
    build:
      context: . # 构建上下文为当前目录
      dockerfile: Dockerfile # 使用当前目录的Dockerfile
    container_name: code-server # 容器名称
    environment:
      - PASSWORD=your_password_here # 设置code-server的访问密码
      - PROXY_DOMAIN=code-server.my.domain # 设置访问域名（可选）
      - TZ=Asia/Shanghai # 设置容器时区为中国标准时间
    volumes:
      - ./workspace:/home/coder/project # 挂载本地项目目录到容器内
      - ./config:/home/coder/.config # 持久化code-server的配置文件
      - ~/.ssh:/home/coder/.ssh:ro # 挂载SSH密钥（只读模式）
      - ~/.gitconfig:/home/coder/.gitconfig:ro # 挂载Git配置（只读模式）
    ports:
      - "8080:8080" # 映射容器的8080端口到主机的8080端口
    restart: unless-stopped # 容器异常退出时自动重启
    networks:
      - code-server-network # 将容器加入自定义网络
    security_opt:
      - no-new-privileges:true # 增强安全性：禁止容器获取新的特权
    # 代理配置（默认注释）
    # environment:
    #   - HTTP_PROXY=http://172.17.0.1:7890 # HTTP代理设置
    #   - HTTPS_PROXY=http://172.17.0.1:7890 # HTTPS代理设置
    #   - NO_PROXY=localhost,127.0.0.1 # 不使用代理的地址

networks:
  code-server-network: # 定义自定义网络
    driver: bridge # 使用bridge驱动，用于容器间通信